# Caddyfile - Configuração com SSL automático
# Caddy gerencia certificados Let's Encrypt automaticamente
brgestor.com www.brgestor.com {
    # Proxy para API backend
    reverse_proxy /rest/v1/* 72.60.14.172:3333
    reverse_proxy /auth/* 72.60.14.172:3333
    reverse_proxy /api/* 72.60.14.172:3333
    reverse_proxy /health 72.60.14.172:3333
    
    # Frontend estático
    reverse_proxy brgestor:80
    
    # Compressão Gzip
    encode gzip
    
    # Headers de segurança
    header {
        # Segurança básica
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        
        # Cache para assets estáticos
        /assets/* {
            Cache-Control "public, max-age=31536000, immutable"
        }
        
        # Sem cache para HTML
        /*.html {
            Cache-Control "no-cache, no-store, must-revalidate"
        }
    }
    
    # Logs detalhados
    log {
        output file /var/log/caddy/access.log
        format json
    }
}

# Proxy HTTPS para WAHA API
waha.brgestor.com {
    reverse_proxy 72.60.14.172:3000

    # Logs
    log {
        output file /var/log/caddy/waha-access.log
        format json
    }
}

